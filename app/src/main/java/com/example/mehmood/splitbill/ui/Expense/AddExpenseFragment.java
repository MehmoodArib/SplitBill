package com.example.mehmood.splitbill.ui.Expense;import android.os.Bundle;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.Button;import android.widget.CompoundButton;import android.widget.LinearLayout;import android.widget.Switch;import android.widget.TextView;import com.example.mehmood.splitbill.R;import com.example.mehmood.splitbill.data.Contact;import com.example.mehmood.splitbill.data.Event;import com.example.mehmood.splitbill.data.EventViewModel;import com.example.mehmood.splitbill.data.Expense;import com.example.mehmood.splitbill.utils.Utilities.Utility;import com.google.android.material.textfield.TextInputEditText;import java.util.List;import java.util.Objects;import androidx.annotation.NonNull;import androidx.fragment.app.Fragment;import androidx.lifecycle.Observer;import androidx.lifecycle.ViewModelProviders;public class AddExpenseFragment extends Fragment {    private TextInputEditText mExpenseNameTextInputEditText;    private TextInputEditText mExpenseAmountTextInputEditText;    private Button mAddExpenseButton;    private Switch mPaidByMeSwitch;    private Switch mPaidForAllSwitch;    private EventViewModel mEventViewModel;    private String expenseName;    private Double expenseAmount;    private Expense mExpense = new Expense();    private Integer eventId;    private List<Contact> participants;    private LinearLayout mlinearLayout;    private Boolean mFlag1 = false; //Flag That Shows That ParticipantsList For PaidBy    // Is Inflated Or Not else it will inflate every time switch paid my be is turned off.    private Boolean mFlag2 = false; //Flag That Shows That ParticipantsList For PaidFor Is Inflated    // Or Not else it will inflate every time switch paid for All is turned off.    @Override    public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,                             Bundle savedInstanceState) {        super.onCreateView(inflater, container, savedInstanceState);        final View view = inflater.inflate(R.layout.fragment_add_expense, container,                false);        setHasOptionsMenu(false);        mEventViewModel = ViewModelProviders.of(getActivity()).get(EventViewModel.class);        assert getArguments() != null;        eventId = getArguments().getInt(Utility.eventId, -1);        //mEventViewModel.getEvent(eventId);        mEventViewModel.getEvent().observe(this, new Observer<Event>() {            @Override            public void onChanged(Event event) {                participants = event.getParticipantsList();                final LinearLayout mPaidByLinearLayout;                final LinearLayout mPAidForLinearLayout;                mPaidByLinearLayout = view.findViewById(R.id.paidByLinearLayout);                mPAidForLinearLayout = view.findViewById(R.id.paidForLinearLayout);                mPaidByMeSwitch = view.findViewById(R.id.paidByMeSwitchButton);                mPaidForAllSwitch = view.findViewById(R.id.paidForAllSwitchButton);                mPaidByLinearLayout.setVisibility(View.GONE);                mPAidForLinearLayout.setVisibility(View.GONE);                for (int i = 0; i < participants.size(); i++) {                    View view2 = LayoutInflater.from(getActivity()).inflate(R.layout.participant, null);                    TextView textView = view2.findViewById(R.id.participantTextView);                    textView.setText(participants.get(i).getName());                    mPAidForLinearLayout.addView(view2);                }                for (int i = 0; i < participants.size(); i++) {                    View view1 = LayoutInflater.from(getActivity()).inflate(R.layout.participant, null);                    TextView textView = view1.findViewById(R.id.participantTextView);                    textView.setText(participants.get(i).getName());                    mPaidByLinearLayout.addView(view1);                }                mPaidForAllSwitch.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {                    @Override                    public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {                        if (mPaidForAllSwitch.isChecked()) {                            mPAidForLinearLayout.setVisibility(View.GONE);                        }                        if (!mPaidForAllSwitch.isChecked()) {                            mPAidForLinearLayout.setVisibility(View.VISIBLE);                        }                    }                });                mPaidByMeSwitch.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {                    @Override                    public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {                        if (mPaidByMeSwitch.isChecked()) {                            mPaidByLinearLayout.setVisibility(View.GONE);                        }                        if (!mPaidByMeSwitch.isChecked()) {                            mPaidByLinearLayout.setVisibility(View.VISIBLE);                        }                    }                });            }        });        mExpenseAmountTextInputEditText = view.findViewById(R.id.textInputEditTextExpenseAmount);        mExpenseNameTextInputEditText = view.findViewById(R.id.textInputEditTextExpenseName);        mAddExpenseButton = view.findViewById(R.id.buttonAddExpense);        mAddExpenseButtonListener();        return view;    }    private void mAddExpenseButtonListener() {        mAddExpenseButton.setOnClickListener(new View.OnClickListener() {            @Override            public void onClick(View v) {                if (!validateExpenseName()) return;                if (!validateExpenseAmount()) return;                mExpense.setExpenseName(expenseName);                mExpense.setExpenseAmount(expenseAmount);                mExpense.setExpenseEventId(eventId);                mEventViewModel.addExpense(mExpense);                mEventViewModel.getExpenseOfEvent(eventId);                //pop-ing up this fragment to go back to ExpenseFragment.                androidx.fragment.app.Fragment fragment = getActivity().getSupportFragmentManager().findFragmentByTag(AddExpenseFragment.class.getSimpleName());                if (fragment != null)                    getActivity().getSupportFragmentManager().popBackStack();            }        });    }    private boolean validateExpenseAmount() {        expenseAmount = Double.valueOf(Objects.requireNonNull(mExpenseAmountTextInputEditText.getText()).toString().trim());        if (expenseAmount <= 0) {            mExpenseAmountTextInputEditText.setError("Expense Should be greater then 0");            return false;        } else {            mExpenseAmountTextInputEditText.setError(null);            return true;        }    }    private boolean validateExpenseName() {        expenseName = mExpenseNameTextInputEditText.getText().toString().trim();        if (expenseName.isEmpty()) {            mExpenseNameTextInputEditText.setError("Field Can't be empty");            return false;        }        if (expenseName.length() > 20) {            mExpenseNameTextInputEditText.setError("Maximum 20 characters Allowed");            return false;        } else {            mExpenseNameTextInputEditText.setError(null);            return true;        }    }}